import React, { useEffect } from 'react'
import { useSelector, useDispatch } from 'react-redux'
import { getPosts } from 'DAL/postsFetching'

import Post from 'components/Post'
import Loader from 'components/Loader'

const HomePage = (props) => {
   const path = props.match.path === '/'
   const loggedIn = useSelector(state => state.auth.loggedIn)
   const posts = useSelector(state => state.post.posts)
   const userId = useSelector(state => state.user.currentUserData.id)
   const dispatch = useDispatch()

   useEffect(() => {
      if (!loggedIn) {
         return
      }
      dispatch(getPosts())
   }, [dispatch])


   const helloTitle = () => (
      <div>
         <h1>Welcome</h1>
      </div>
   )

   const renderPosts = () => (
      <div className='global_feed'>
         {path
            ? (
               <div>
                  {
                     posts.map((post) => (
                        <Post
                           text={post.text}
                           id={post.id}
                           key={post.id}
                           user={post.user_id}
                        />
                     ))
                  }
               </div>)
            : (
               <div>
                  {
                     posts.filter(post => post.user_id === userId).map(post => (
                        <Post
                           text={post.text}
                           id={post.id}
                           key={post.id}
                           user={post.user_id}
                        />
                     ))
                  }
               </div>
            )
         }
      </div>
   )

   const loadigPosts = () => (
      <div className='posts'>
         {posts
            ? renderPosts()
            : <Loader />
         }
      </div>
   )


   return (
      <div className='home_page'>
         {
            loggedIn
               ? loadigPosts()
               : helloTitle()
         }
      </div>
   )
}

export default HomePage










