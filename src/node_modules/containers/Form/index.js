import React, { useState } from 'react'
import { useDispatch } from 'react-redux'
import { fetchNewPost, fetchUpdatePost } from 'DAL/postsFetching'
import { useHistory } from 'react-router'

const Form = props => {
   const path = props.match.path === '/createNewPost'
   const postId = path ? null : props.match.params.slug 
   const titleText = path ? 'Create New Post' : `Edit Post ${postId}`
   const [text, setText] = useState('')
   const dispatch = useDispatch()
   const history = useHistory()

   const handleSubmit = event => {
      event.preventDefault()
      if (path) {
         dispatch(fetchNewPost(text))
         setTimeout(() => {
            history.push('/myposts')
         }, 2000)
      } else {
         dispatch(fetchUpdatePost(postId, text))
         setTimeout(() => {
            history.push('/myposts')
         }, 2000)
      }
      
   }

   return (
      <div>
      <h2>{titleText}</h2>
         <form onSubmit={handleSubmit}>
            <textarea 
               placeholder=''
               value={text}
               onChange={e => setText(e.target.value)}
            />
            <button>Complete</button>
         </form>
      </div>
   )
}

export default Form