import axios from 'axios'
import { getComments, addComment } from 'redux/actions/comments'

const token = localStorage.getItem('token')

export const fetchComments = (id) => dispatch => {
   axios({
      method: 'GET',
      url: `https://test.flcd.ru/api/post/${id}/comments`,
      headers: {
         'accept': '*/*',
         'Authorization': `Bearer ${token}`,
         'Content-type': 'application/json',
     }
   })
   .then(res => {
      dispatch(getComments(res.data))
      console.log(res.status)
   })
   .catch(err => {
      console.log(err)
   })
}

export const fetchSetPost = (text, postId) => dispatch => {
   axios({
      method: 'POST',
      url: 'https://test.flcd.ru/api/comment',
      data: {
         text: text,
         post_id: postId,
         reply_to_comment: 0
      },
      headers: {
         'accept': '*/*',
         'Authorization': `Bearer ${token}`,
         'Content-type': 'application/json',
     }
   })
   .then(res => {
      dispatch(addComment(res.data))
      console.log('Комент отправлен', res.status, res.data)
   })
   .catch(err => {
      console.log(err)
   })
}