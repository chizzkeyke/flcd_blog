import React, { useState } from 'react'
import { useSelector, useDispatch } from 'react-redux'
import { fetchEditComment, fetchDeleteComment } from 'DAL/commentsFetch'
import './style.css'

const Comment = ({ user_id, text, id }) => {
   const [toggleInputEditComment, setToggleInputEditComment] = useState(false)
   const [editText, setEditText] = useState('')

   const userId = useSelector(state => state.user.currentUserData.id)
   const dispatch = useDispatch()

   const handleSubmitEditComment = event => {
      event.preventDefault()
      dispatch(fetchEditComment(id, editText))
   }

   return (
      <div className='comment'>
         <h3>Пользователь {user_id}</h3>
         <p>ID коммента {id}</p>
         <p>{text}</p>
         {
            userId === user_id
               ? (
                  <div>
                     <button onClick={() => setToggleInputEditComment(!toggleInputEditComment)}>Edit comment</button>
                     <button onClick={() => dispatch(fetchDeleteComment(id))}>Delete comment</button>
                  </div>
               )
               : null
         }
         {
            toggleInputEditComment && (
               <form onSubmit={handleSubmitEditComment}>
                  <textarea
                     placeholder='Текст...'
                     value={editText}
                     onChange={e => setEditText(e.target.value)}
                  />
                  <button>Submit</button>
               </form>
            )
         }
      </div>
   )
}

export default Comment